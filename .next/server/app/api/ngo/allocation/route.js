"use strict";(()=>{var e={};e.id=741,e.ids=[741],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55876:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>v,patchFetch:()=>m,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>c});var o={};n.r(o),n.d(o,{GET:()=>d});var r=n(36126),a=n(69184),i=n(36197),s=n(53524),l=n(81602);let u=new s.PrismaClient;async function d(e){try{let t;let{searchParams:n}=new URL(e.url),o=n.get("latitude"),r=n.get("longitude"),a=n.get("eventID"),i=n.get("needType"),s=n.get("maxDistance");if((!o||!r)&&!a)return l.NextResponse.json({error:"Either coordinates (latitude/longitude) or eventID is required"},{status:400});if(a){let e=await u.event.findUnique({where:{eventID:parseInt(a)},select:{lat:!0,lng:!0}});if(!e||!e.lat||!e.lng)return l.NextResponse.json({error:"Event not found or has no location data"},{status:404});t={latitude:e.lat,longitude:e.lng}}else t={latitude:parseFloat(o),longitude:parseFloat(r)};let d=await u.nGO_ServiceArea.findMany({where:{isActive:!0,...s?{radiusKm:{lte:parseFloat(s)}}:{}},include:{ngo:{select:{ngoID:!0,name:!0,supportType:!0,focusArea:!0,contact:!0,email:!0,isActive:!0,isVerified:!0}}}}),p=findNGOsInRadius(t.latitude,t.longitude,d),g=p;if(i&&(g=p.filter(e=>{let t=d.find(t=>t.ngoID===e.ngoID)?.ngo;return!!t&&(t.focusArea?.toLowerCase().includes(i.toLowerCase())||t.supportType?.toLowerCase().includes(i.toLowerCase()))})),i){let e=await u.nGO_ResourceInventory.findMany({where:{ngoID:{in:g.map(e=>e.ngoID)},resourceType:{contains:i,mode:"insensitive"},isAvailable:!0,quantity:{gt:0}}});g=g.map(t=>{let n=e.filter(e=>e.ngoID===t.ngoID);return{...t,ngoInfo:d.find(e=>e.ngoID===t.ngoID)?.ngo,availableResources:n}})}else g=g.map(e=>({...e,ngoInfo:d.find(t=>t.ngoID===e.ngoID)?.ngo}));return l.NextResponse.json({ngos:g,total:g.length})}catch(e){return console.error("Error in NGO allocation API:",e),l.NextResponse.json({error:"An error occurred while finding NGOs"},{status:500})}}let p=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/ngo/allocation/route",pathname:"/api/ngo/allocation",filename:"route",bundlePath:"app/api/ngo/allocation/route"},resolvedPagePath:"/Users/tazkia/Desktop/Uddhar/app/api/ngo/allocation/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:c,serverHooks:f}=p,v="/api/ngo/allocation/route";function m(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:c})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),o=t.X(0,[9576,4946],()=>n(55876));module.exports=o})();