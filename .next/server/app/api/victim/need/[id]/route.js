"use strict";(()=>{var e={};e.id=4641,e.ids=[4641],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7910:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>N,patchFetch:()=>g,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{DELETE:()=>l,GET:()=>c,PUT:()=>p});var i=r(36126),s=r(69184),o=r(36197),a=r(53524),d=r(81602);let u=new a.PrismaClient;async function c(e,{params:t}){try{let e=parseInt(t.id);if(isNaN(e))return d.NextResponse.json({error:"Invalid need ID"},{status:400});let r=await u.victimNeed.findUnique({where:{needID:e},include:{victim:{select:{birthCertificateNumber:!0,name:!0,status:!0,gender:!0,medical:{select:{bloodGroup:!0,medicalCondition:!0}},family:{select:{headName:!0,contact:!0}},event:{select:{eventID:!0,description:!0,location:!0,date:!0}}}}}});if(!r)return d.NextResponse.json({error:"Victim need not found"},{status:404});let n=await u.serviceRequest.findMany({where:{birthCertificateNumber:r.birthCertificateNumber,requestType:{contains:r.needType,mode:"insensitive"}},select:{requestID:!0,ngoID:!0,requestDate:!0,status:!0,ngo:{select:{name:!0}}},orderBy:{requestDate:"desc"}}),i=await u.nGO.findMany({where:{OR:[{supportType:{contains:r.needType,mode:"insensitive"}},{focusArea:{contains:r.needType,mode:"insensitive"}}],isActive:!0},select:{ngoID:!0,name:!0,supportType:!0,focusArea:!0,contact:!0},take:5});return d.NextResponse.json({...r,serviceRequests:n,matchingNGOs:i})}catch(e){return console.error("Error fetching victim need:",e),d.NextResponse.json({error:"Failed to fetch victim need"},{status:500})}}async function p(e,{params:t}){try{let r=parseInt(t.id);if(isNaN(r))return d.NextResponse.json({error:"Invalid need ID"},{status:400});let{needType:n,urgencyLevel:i,status:s,notes:o,dateAddressed:a}=await e.json(),c=await u.victimNeed.findUnique({where:{needID:r}});if(!c)return d.NextResponse.json({error:"Victim need not found"},{status:404});if(i&&!["high","medium","low"].includes(i.toLowerCase()))return d.NextResponse.json({error:"Urgency level must be high, medium, or low"},{status:400});if(s&&!["pending","addressed","ongoing"].includes(s))return d.NextResponse.json({error:"Status must be pending, addressed, or ongoing"},{status:400});let p={...n&&{needType:n},...i&&{urgencyLevel:i.toLowerCase()},...s&&{status:s},...void 0!==o&&{notes:o},...a&&{dateAddressed:new Date(a)}};"addressed"!==s||c.dateAddressed||a||(p.dateAddressed=new Date);let l=await u.victimNeed.update({where:{needID:r},data:p,include:{victim:{select:{name:!0}}}});return d.NextResponse.json(l)}catch(e){return console.error("Error updating victim need:",e),d.NextResponse.json({error:"Failed to update victim need"},{status:500})}}async function l(e,{params:t}){try{let e=parseInt(t.id);if(isNaN(e))return d.NextResponse.json({error:"Invalid need ID"},{status:400});let r=await u.victimNeed.findUnique({where:{needID:e}});if(!r)return d.NextResponse.json({error:"Victim need not found"},{status:404});let n=await u.serviceRequest.findMany({where:{birthCertificateNumber:r.birthCertificateNumber,requestType:{contains:r.needType,mode:"insensitive"}}});if(n.length>0)return d.NextResponse.json({error:"Cannot delete need with related service requests",relatedRequests:n.length},{status:400});return await u.victimNeed.delete({where:{needID:e}}),d.NextResponse.json({message:"Victim need deleted successfully"})}catch(e){return console.error("Error deleting victim need:",e),d.NextResponse.json({error:"Failed to delete victim need"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/victim/need/[id]/route",pathname:"/api/victim/need/[id]",filename:"route",bundlePath:"app/api/victim/need/[id]/route"},resolvedPagePath:"/Users/tazkia/Desktop/Uddhar/app/api/victim/need/[id]/route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:v,staticGenerationAsyncStorage:f,serverHooks:h}=m,N="/api/victim/need/[id]/route";function g(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9576,4946],()=>r(7910));module.exports=n})();